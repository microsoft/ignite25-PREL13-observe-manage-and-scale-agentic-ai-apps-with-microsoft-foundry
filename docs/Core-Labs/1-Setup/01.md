# 1.1 Provision Infrastructure

We will provision the AZD "Get Started with AI Agents" template as our infrastructure. These notes correspond to [this commit](https://github.com/nitya/get-started-with-ai-agents/commit/c63e1384ae6a295b3d57378fab02ac4227bf835d) on the AZD template repo. My goal is to document the usage and customization of this template to support various projects - as pre-provisioned infrastructure.

<br/>

## 0. Fork Template & Launch Codespaces

1. Visit the [Get Started With AI Agents](https://github.com/Azure-Samples/get-started-with-ai-agents) repo 
1. Fork it to your profile to get a custom copy (.e., [my fork-branch](https://github.com/nitya/get-started-with-ai-agents/tree/sep2025-pdy123-infra))
1. Launch GitHub Codespaces on your fork
1. Wait till the browser VS Code loads - and an active terminal appears.

_You are ready to deploy the template_


## 1. Set AZD Env Variables

The azd template can be customized in many ways - the easiest starting point is to use environment variables to customize the resource deployment paramters. Run these commands in the Codespaces terminal.  _Note: Pick unique names for the last 2 variables that set the Foundry project and resource names in Azure AI Foundry Portal_

```bash
azd env set AZURE_AI_AGENT_DEPLOYMENT_CAPACITY 100
azd env set ENABLE_AZURE_MONITOR_TRACING true
azd env set AZURE_TRACING_GEN_AI_CONTENT_RECORDING_ENABLED true
azd env set USE_AZURE_AI_SEARCH_SERVICE true
azd env set USE_APPLICATION_INSIGHTS true
azd env set AZURE_AIPROJECT_NAME nitya-pdy123-aiproj-v1
azd env set AZURE_AISERVICES_NAME nitya-pdy123-aisvcs-v1
```

## 2. Deploy it

```bash
azd up
```

Note that we did not do any pre-authentication step. So we'll get prompted to login using a device-code workflow like this:

```bash
? Would you like to log in now? Yes

Start by copying the next code: XXXXXXX
Then press enter and continue to log in from your browser...
```

Next you'll be prompted to select your subscription and the region for deployment. I used `East US2`. Then just let the provisioning complete. **This can take 10-15 minutes given our added requirements** - the default (basic) template provisions in 4-6 minutes. _The output looks like this - the first section provisions resources, the second deploys the app_.

```bash
You can view detailed progress in the Azure Portal:
<url here>

(âœ“) Done: Resource group: rg-nitya-pdy123-azd-v1 (447ms)
(âœ“) Done: Log Analytics workspace: log-vchqcvq7rwoju (22.557s)
(âœ“) Done: Storage account: stvchqcvq7rwoju (20.675s)
(âœ“) Done: Application Insights: appi-vchqcvq7rwoju (3.537s)
(âœ“) Done: Azure AI Services: nitya-pdy123-aisvcs-v1 (1m8.574s)
(âœ“) Done: Azure AI Services Model Deployment: nitya-pdy123-aisvcs-v1/text-embedding-3-small (1m10.589s)
(âœ“) Done: Azure AI Services Model Deployment: nitya-pdy123-aisvcs-v1/gpt-4o-mini (1m10.027s)
(âœ“) Done: Search service: srch-vchqcvq7rwoju (4m50.479s)
(âœ“) Done: Container Registry: crvchqcvq7rwoju (19.98s)
(âœ“) Done: Container Apps Environment: containerapps-env-vchqcvq7rwoju (1m24.269s)
(âœ“) Done: Container App: ca-api-vchqcvq7rwoju (17.742s)

Deploying services (azd deploy)

Deploying service api_and_frontend (Running remote build)
- Endpoint: https://......eastus2.azurecontainerapps.io/
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Docker Output â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ðŸ’¡ (Optional) To setup username and password for the web application, run './scripts/setup_credential.sh'.

SUCCESS: Your up workflow to provision and deploy to Azure completed in 11 minutes 50 seconds.
```
